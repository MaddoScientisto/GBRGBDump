@page "/"
@using GBTools.Bootstrapper
@using GBTools.Common
@rendermode InteractiveServer
@inject ImageTransformService ImageTransformService

<PageTitle>Home</PageTitle>

<p>Asdf</p>

<p>Input</p>
<input @bind="inputPath" />
<p>Output</p>
<input @bind="outputPath" />

<button @onclick="Exececute">Execute</button>

@code
{
    private string? inputPath;
    private string? outputPath;
    private bool? cartIsJp;

    private async Task Exececute()
    {
        if (string.IsNullOrWhiteSpace(inputPath) || string.IsNullOrWhiteSpace(outputPath)) return;


        var importParams = new ImportSavOptions()
            {
                ImportLastSeen = false,
                ImportDeleted = true,
                ForceMagicCheck = false,
                AverageType = AverageTypes.Normal,
                AebStep = 2,
                BanksToProcess = -1,
                CartIsJp = cartIsJp ?? false,
                ChannelOrder = ChannelOrder.Sequential,
                RgbMerge = true
            };

        var progress = new Progress<ProgressInfo>(ReportProgress);

        var result = await Task.Run(() =>
            ImageTransformService.TransformSav(inputPath, outputPath, importParams, progress));


    }

    private void ReportProgress(ProgressInfo value)
    {
        // do nothing
    }
}
